<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Post - SSPL Forum</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital@1&display=swap" rel="stylesheet">
    <style>
        .post-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group select,
        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .submit-btn, .add-option-btn {
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .add-option-btn {
            padding: 5px 10px;
            font-size: 14px;
            margin-top: 10px;
        }

        .submit-btn:hover, .add-option-btn:hover {
            background-color: #34495e;
        }

        /* Notification Modal Styles */
        .notification-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            text-align: center;
        }

        .notification-modal.show {
            display: block;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .modal-overlay.show {
            display: block;
        }

        .success-icon {
            color: #28a745;
            font-size: 48px;
            margin-bottom: 15px;
        }

        .modal-btn {
            background-color: #2c3e50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }

        .modal-btn:hover {
            background-color: #34495e;
        }

        /* Poll Section Styles */
        .poll-section {
            display: none;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .poll-option {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .remove-option {
            color: red;
            cursor: pointer;
            font-size: 18px;
        }

        .toggle-poll {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Attachment Styles */
        .attachment-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .attachment-item {
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Emoji Picker Styles */
        .emoji-picker {
            position: relative;
            display: inline-block;
        }

        .emoji-button {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
        }

        .emoji-panel {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 200px;
        }

        .emoji-panel.show {
            display: grid;
        }

        .emoji-option {
            font-size: 1.2em;
            padding: 5px;
            cursor: pointer;
            text-align: center;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .emoji-option:hover {
            background-color: #f0f0f0;
        }

        /* Enhanced File Preview Styles */
        .file-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .file-preview-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: #f9f9f9;
        }

        .file-preview-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 3px;
        }

        .file-preview-item .file-info {
            margin-top: 5px;
            font-size: 0.8em;
            color: #666;
        }

        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .file-preview-item .file-icon {
            font-size: 2em;
            color: #666;
            text-align: center;
            margin: 10px 0;
        }

        .form-group textarea {
            padding-right: 40px; /* Make room for emoji button */
        }

        .emoji-trigger-container {
            position: absolute;
            right: 10px;
            bottom: 10px;
        }
    </style>
</head>

<body>
    <header>
        <div class="navbar">
            <nav class="navigation hide" id="navigation">
                <span class="close-icon" id="close-icon" onclick="showIconBar()"><i class="fa fa-close"></i></span>
                <ul class="nav-list">
                    <li class="nav-item"><a href="forums.html">Forums</a></li>
                    <li class="nav-item"><a href="posts.html">Posts</a></li>
                    <li class="nav-item"><a href="detail.html">Detail</a></li>
                </ul>
            </nav>
            <a class="bar-icon" id="iconBar" onclick="hideIconBar()"><i class="fa fa-bars"></i></a>
            <img src="https://sandipanch.tech/logo.jpeg" id="logo" alt="drdo logo" />
            <div class="brand">ठोसावस्था भौतिकी प्रयोगशाला बुलेटिन बोर्ड / Solid State Physics Laboratory Bulletin Board</div>
        </div>
    </header>

    <div class="container">
        <div class="subforum">
            <div class="subforum-title">
                <h1>Create New Post</h1>
            </div>
            
            <div class="post-form">
                <form id="postForm" onsubmit="return handleSubmit(event)">
                    <div class="form-group">
                        <label for="forum-section">Select Forum Section:</label>
                        <select id="forum-section" name="forum-section" required>
                            <option value="">Select a section...</option>
                            <option value="admin">प्रशासन / Admin</option>
                            <option value="cghs">सीजीएचएस / CGHS</option>
                            <option value="csd">सीएसडी कैंटीन / CSD Canteen</option>
                            <option value="finance">बित्त / Finance</option>
                            <option value="hrd">एचआरडी / HRD</option>
                            <option value="it">सुचना प्रद्योगिकी समूह / Information Technology Group</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="post-title">Post Title:</label>
                        <input type="text" id="post-title" name="post-title" required>
                    </div>

                    <div class="form-group">
                        <label for="post-content">Post Content:</label>
                        <textarea id="post-content" name="post-content" required></textarea>
                        <div class="emoji-trigger-container">
                            <div class="emoji-picker">
                                <button type="button" class="emoji-button" onclick="toggleEmojiPanel('post-content')">
                                    😊
                                </button>
                                <div class="emoji-panel" id="emoji-panel-post-content"></div>
                            </div>
                        </div>
                    </div>

                    <div class="toggle-poll" onclick="togglePoll()">
                        <i class="fa fa-plus"></i> Add Poll
                    </div>

                    <div id="pollSection" class="poll-section">
                        <div class="form-group">
                            <label for="poll-question">Poll Question:</label>
                            <input type="text" id="poll-question" name="poll-question">
                            <div class="emoji-trigger-container">
                                <div class="emoji-picker">
                                    <button type="button" class="emoji-button" onclick="toggleEmojiPanel('poll-question')">
                                        😊
                                    </button>
                                    <div class="emoji-panel" id="emoji-panel-poll-question"></div>
                                </div>
                            </div>
                        </div>
                        <div id="pollOptions">
                            <div class="poll-option">
                                <input type="text" placeholder="Option 1" class="poll-option-input">
                                <span class="remove-option" onclick="removeOption(this)">×</span>
                            </div>
                        </div>
                        <button type="button" class="add-option-btn" onclick="addOption()">
                            <i class="fa fa-plus"></i> Add Option
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="attachments">Attachments:</label>
                        <input type="file" id="attachments" multiple onchange="handleFiles(event)">
                        <div id="attachmentPreview" class="file-preview-container"></div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="submit-btn">
                            <i class="fa fa-paper-plane"></i> Submit Post
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="notification-modal" id="notificationModal">
        <i class="fa fa-check-circle success-icon"></i>
        <h3>Post Submitted Successfully!</h3>
        <p>Your post has been submitted to the forum.</p>
        <button class="modal-btn" onclick="redirectToForum()">Return to Forum</button>
    </div>

    <footer>
        <span>&copy; Selmi Abderrahim | All Rights Reserved</span>
    </footer>
    
    <script src="main.js"></script>
    <script>

const emojis = ['😊', '👍', '❤️', '🎉', '😂', '🤔', '👏', '🌟', '💡', '✨', 
                       '🔥', '💪', '🙏', '👀', '💯', '🎈', '🎨', '📝', '💬', '✅'];

        // Initialize emoji panels
        function initializeEmojiPanels() {
            const panels = document.querySelectorAll('.emoji-panel');
            panels.forEach(panel => {
                emojis.forEach(emoji => {
                    const emojiOption = document.createElement('div');
                    emojiOption.className = 'emoji-option';
                    emojiOption.textContent = emoji;
                    emojiOption.onclick = () => insertEmoji(emoji, panel.id.replace('emoji-panel-', ''));
                    panel.appendChild(emojiOption);
                });
            });
        }

        // Toggle emoji panel
        function toggleEmojiPanel(targetId) {
            const panel = document.getElementById(`emoji-panel-${targetId}`);
            const allPanels = document.querySelectorAll('.emoji-panel');
            allPanels.forEach(p => {
                if (p !== panel) p.classList.remove('show');
            });
            panel.classList.toggle('show');
        }

        // Insert emoji into target field
        function insertEmoji(emoji, targetId) {
            const target = document.getElementById(targetId);
            const start = target.selectionStart;
            const end = target.selectionEnd;
            const text = target.value;
            target.value = text.substring(0, start) + emoji + text.substring(end);
            target.focus();
            target.selectionStart = target.selectionEnd = start + emoji.length;
            document.getElementById(`emoji-panel-${targetId}`).classList.remove('show');
        }

        // Handle file selection and preview
        function handleFiles(event) {
            const files = event.target.files;
            const preview = document.getElementById('attachmentPreview');
            preview.innerHTML = '';
            
            Array.from(files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-preview-item';
                
                const removeButton = document.createElement('button');
                removeButton.className = 'remove-file';
                removeButton.innerHTML = '×';
                removeButton.onclick = () => removeFile(fileItem);
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    const reader = new FileReader();
                    reader.onload = e => img.src = e.target.result;
                    reader.readAsDataURL(file);
                    fileItem.appendChild(img);
                } else {
                    const fileIcon = document.createElement('div');
                    fileIcon.className = 'file-icon';
                    fileIcon.innerHTML = '<i class="fa fa-file"></i>';
                    fileItem.appendChild(fileIcon);
                }
                
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                fileInfo.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                
                fileItem.appendChild(removeButton);
                fileItem.appendChild(fileInfo);
                preview.appendChild(fileItem);
            });
        }

        // Remove file from preview
        function removeFile(element) {
            element.remove();
            // Note: You'll need to handle clearing the actual file input or tracking selected files
            // depending on your form submission requirements
        }

        // Initialize emoji panels when the page loads
        document.addEventListener('DOMContentLoaded', initializeEmojiPanels);

        // Close emoji panels when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.emoji-picker')) {
                document.querySelectorAll('.emoji-panel').forEach(panel => {
                    panel.classList.remove('show');
                });
            }
        });

        // Existing functions remain the same
        function handleSubmit(event) {
            event.preventDefault();
            document.getElementById('modalOverlay').classList.add('show');
            document.getElementById('notificationModal').classList.add('show');
            document.getElementById('postForm').reset();
            document.getElementById('attachmentPreview').innerHTML = '';
            return false;
        }

        function redirectToForum() {
            document.getElementById('modalOverlay').classList.remove('show');
            document.getElementById('notificationModal').classList.remove('show');
            window.location.href = 'forums.html';
        }

        function togglePoll() {
            const pollSection = document.getElementById('pollSection');
            pollSection.style.display = pollSection.style.display === 'none' ? 'block' : 'none';
        }

        function addOption() {
            const pollOptions = document.getElementById('pollOptions');
            const optionCount = pollOptions.children.length + 1;
            const newOption = document.createElement('div');
            newOption.className = 'poll-option';
            newOption.innerHTML = `
                <input type="text" placeholder="Option ${optionCount}" class="poll-option-input">
                <span class="remove-option" onclick="removeOption(this)">×</span>
            `;
            pollOptions.appendChild(newOption);
        }

        function removeOption(element) {
            element.parentElement.remove();
        }
    </script>
    <script>
        // Check user department on page load
        document.addEventListener('DOMContentLoaded', function() {
            const userDepartment = localStorage.getItem('userDepartment');
            const userType = localStorage.getItem('userType');
            const forumSection = document.getElementById('forum-section');
            
            if (!localStorage.getItem('isLoggedIn')) {
                // Redirect to login if not logged in
                window.location.href = 'login2.html';
                return;
            }
        
            if (userType === 'employee' && userDepartment !== 'all') {
                // For department admins, set and lock their department
                forumSection.value = userDepartment;
                forumSection.disabled = true;
                
                // Hide other options
                Array.from(forumSection.options).forEach(option => {
                    if (option.value !== userDepartment && option.value !== '') {
                        option.style.display = 'none';
                    }
                });
            }
            // Master admin can access all departments, no restrictions needed
        });
        </script>
</body>
</html>